FROM python:3.8
WORKDIR /app
COPY . .

RUN pip3 install -r requirements.txt --disable-pip-version-check

ARG SERV_URL JWT_SECRET JWT_VALIDITY_DELTA TWITTER_CLIENT_ID TWITTER_CLIENT_SECRET GITHUB_CLIENT_ID GITHUB_CLIENT_SECRET DISCORD_BOT_TOKEN POSTGRES_PASSWORD POSTGRES_USER POSTGRES_PORT POSTGRES_HOST POSTGRES_DB_NAME
ENV SERV_URL $SERV_URL
ENV JWT_SECRET $JWT_SECRET
ENV JWT_VALIDITY_DELTA $JWT_VALIDITY_DELTA
ENV TWITTER_CLIENT_ID $TWITTER_CLIENT_ID
ENV TWITTER_CLIENT_SECRET $TWITTER_CLIENT_SECRET
ENV GITHUB_CLIENT_ID $GITHUB_CLIENT_ID
ENV GITHUB_CLIENT_SECRET $GITHUB_CLIENT_SECRET
ENV DISCORD_BOT_TOKEN $DISCORD_BOT_TOKEN
ENV POSTGRES_PASSWORD $POSTGRES_PASSWORD
ENV POSTGRES_USER $POSTGRES_USER
ENV POSTGRES_PORT $POSTGRES_PORT
ENV POSTGRES_HOST $POSTGRES_HOST
ENV POSTGRES_DB_NAME $POSTGRES_DB_NAME

ENV PYTHONUNBUFFERED=1
ENV FLASK_APP="/app/app:app"
EXPOSE 5000

CMD ["python3", "-m", "flask", "run", "--host", "0.0.0.0"]